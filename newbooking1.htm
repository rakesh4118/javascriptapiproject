<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRUD App with Bootstrap</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
  <div class="container mt-5">
    <form>
      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="NameInput">Selling Item</label>
            <input type="text" class="form-control form-control-sm" id="NameInput" placeholder="Enter Item">
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="EmailInput">Selling Price</label>
            <input type="number" class="form-control form-control-sm" id="EmailInput" placeholder="Enter Price">
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="contactInput">Quantity</label>
            <div class="input-group">
              <input type="text" class="form-control form-control-sm" id="contactInput" placeholder="Enter Quantity">
              <div class="input-group-append">
                <select class="form-control form-control-sm" id="quantityUnit">
                  <option value="KG">KG</option>
                  <option value="GM">GM</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <button type="button" id="submitbtn" class="btn btn-primary btn-sm">Submit</button>
        </div>
      </div>
    </form>
    <hr>
    <ul id="items" class="list-group"></ul>
    <p id="totalPrice" class="mt-3 font-weight-bold">Total Price: 0 rupees</p> <!-- Added Bootstrap classes for styling -->
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.4/axios.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    const crudurl = "https://crudcrud.com/api/bcf0ff949d3b46f28d7adc227b9c29f6";
    let list = document.getElementById('items');

    showData();

    function createListItem(name, number, text) {
      let li = document.createElement('li');
      li.className = "list-group-item d-flex justify-content-between align-items-center";
      
      let itemTextColumn = document.createElement('div');
      itemTextColumn.textContent = `${name} - ${number} rupees - ${text}`;
      
      let buttonColumn = document.createElement('div');
      buttonColumn.className = "btn-group"

      let deletebtn = document.createElement('button');
      deletebtn.innerHTML = 'Delete';
      deletebtn.className = 'btn btn-danger btn-sm';

      let editbtn = document.createElement('button');
      editbtn.innerHTML = "Edit";
      editbtn.className = "btn btn-primary btn-sm";

      buttonColumn.appendChild(deletebtn);
      buttonColumn.appendChild(editbtn);

      li.appendChild(itemTextColumn);
      li.appendChild(buttonColumn);

      return li;
    }

    function calculateTotalPrice() {
      let totalPrice = 0;
      const items = document.querySelectorAll('.list-group-item');
      items.forEach(item => {
        const priceText = item.innerText.split(' - ')[1];
        const price = parseFloat(priceText.replace('rupees', '').trim());
        if (!isNaN(price)) {
          totalPrice += price;
        }
      });
      return totalPrice;
    }

    function updateTotalPrice() {
      const totalPrice = calculateTotalPrice();
      const totalElement = document.getElementById('totalPrice');
      totalElement.innerText = `Total Price: ${totalPrice} rupees`;
    }

    function showData() {
      axios.get(crudurl + "/appointmentData")
        .then((response) => {
          for (let i = 0; i < response.data.length; i++) {
            list.appendChild(createListItem(response.data[i].name, response.data[i].number, response.data[i].text));
          }
          updateTotalPrice();
        })
        .catch((error) => console.log(error));
    }

    let btn = document.getElementById('submitbtn');
    btn.addEventListener('click', (e) => {
      let obj = {
        name: '',
        number: '',
        text: ''
      };
      obj.name = document.getElementById('NameInput').value;
      obj.number = document.getElementById('EmailInput').value;
      obj.text = document.getElementById('contactInput').value;

      axios.post(crudurl + "/appointmentData", obj)
        .then(response => {
          list.appendChild(createListItem(response.data.name, response.data.number, response.data.text));
          updateTotalPrice();
        })
        .catch((error) => console.log(error));
    });

    list.addEventListener('click', e => {
    if (e.target.classList.contains('Delete')) {
      let li = e.target.parentElement; // Get the list item element
      let text = li.textContent.trim(); // Use trim() to remove any leading/trailing spaces
      let item = text.split(" -");

      axios.get(crudurl + "/appointmentData")
        .then(res => {
          for (let i = 0; i < res.data.length; i++) {
            if (res.data[i].name === item[0].trim()) {
              axios.delete(crudurl + "/appointmentData/" + res.data[i]._id)
                .then(() => {
                  list.removeChild(li); // Remove the list item from the UI
                })
                .catch((error) => console.log(error));
            }
          }
        });
    }
    else if (e.target.classList.contains('Edit')) {
      let li = e.target.parentElement; // Get the list item element
      let text = li.textContent.trim(); // Use trim() to remove any leading/trailing spaces
      let item = text.split(" -");

      axios.get(crudurl + "/appointmentData")
        .then(res => {
          for (let i = 0; i < res.data.length; i++) {
            if (res.data[i].name === item[0].trim()) {
              document.getElementById('NameInput').value = res.data[i].name;
              document.getElementById('EmailInput').value = res.data[i].number;
              document.getElementById('contactInput').value = res.data[i].text;

              let btn = document.getElementById('submitbtn');
              btn.textContent = 'Save'; // Change the button text to 'Save'
              btn.removeEventListener('click', submitData); // Remove the previous click event listener
              btn.addEventListener('click', () => {
                let obj = {
                  name: document.getElementById('NameInput').value.trim(), // Use trim() to remove any leading/trailing spaces
                  number: document.getElementById('EmailInput').value.trim(), // Use trim() to remove any leading/trailing spaces
                  text: document.getElementById('contactInput').value.trim(), // Use trim() to remove any leading/trailing spaces
                };
                axios.put(crudurl + "/appointmentData/" + res.data[i]._id, obj) // Make PUT request to the API
                  .then(response => {
                    // Update the list item text after successful response from the server
                    li.textContent = `${response.data.name} - ${response.data.number} rupees - ${response.data.text}`;
                    li.appendChild(buttonColumn);
                    btn.textContent = 'Submit'; // Change the button text back to 'Submit'
                    btn.removeEventListener('click', editData); // Remove the click event listener for editing
                    btn.addEventListener('click', submitData); // Add back the click event listener for submitting
                  })
                  .catch((error) => console.log(error));
              });
            }
          }
        });
    }
  });
  </script>
</body>

</html>
