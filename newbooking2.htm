<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRUD App with Bootstrap</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
  <div class="container mt-5">
    <form>
      <div class="form-group">
        <label for="NameInput">Selling Item</label>
        <input type="text" class="form-control" id="NameInput" placeholder="Enter Item">
      </div>
      <div class="form-group">
        <label for="EmailInput">Selling Price</label>
        <input type="number" class="form-control" id="EmailInput" placeholder="Enter Price">
      </div>
      <div class="form-group">
        <label for="contactInput">Quantity</label>
          <input type="text" class="form-control" id="contactInput" placeholder="Enter Quantity">
      </div>
      <button type="button" id="submitbtn" class="btn btn-primary">Submit</button>
    </form>
    <hr>
    <ul id="items" class="list-group"></ul>
    <p id="totalPrice" class="mt-3 font-weight-bold">Total Price: 0 rupees</p>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.4/axios.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    const crudurl = "https://crudcrud.com/api/38d3b825507e48e1bb467a44ead8cc94";
    let list = document.getElementById('items');

    showData();

    function createListItem(name, number, text) {
      let li = document.createElement('li');
      li.className = "list-group-item d-flex justify-content-between align=items-right";
      
      let deletebtn = document.createElement('button');
      deletebtn.innerHTML = 'Delete';
      deletebtn.className = 'btn btn-danger Delete mr-2';

      let editbtn = document.createElement('button');
      editbtn.innerHTML = "Edit";
      editbtn.className = "btn btn-primary Edit";

      const price = parseFloat(number);
      const quantity = parseFloat(text);

      const totalPrice = isNaN(price) || isNaN(quantity) ? 0 : price * quantity;

      li.innerHTML = `${name} - ${number} rupees - ${text} KG`;
      li.appendChild(deletebtn);
      li.appendChild(editbtn);

      return li;
    }

    function calculateTotalPrice() {
      let totalPrice = 0;
      const items = document.querySelectorAll('.list-group-item');
      items.forEach(item => {
        const itemInfo = item.innerText.split(' - ');
        const price = parseFloat(itemInfo[1]);
        const quantity = parseFloat(itemInfo[2]);
        if (!isNaN(price) && !isNaN(quantity)) {
          totalPrice += price * quantity;
        }
      });
      return totalPrice;
    }

    function updateTotalPrice() {
      const totalPrice = calculateTotalPrice();
      const totalElement = document.getElementById('totalPrice');
      totalElement.innerText = `Total Price: ${totalPrice} rupees`;
    }

    function showData() {
      axios.get(crudurl + "/sellertData")
        .then((response) => {
          for (let i = 0; i < response.data.length; i++) {
            list.appendChild(createListItem(response.data[i].name, response.data[i].number, response.data[i].text));
          }
          updateTotalPrice(); // Calculate and display the total price after fetching the data
        })
        .catch((error) => console.log(error));
    }

    let btn = document.getElementById('submitbtn');
    btn.addEventListener('click', (e) => {
      let obj = {
        name: '',
        number: '',
        text: ''
      };
      obj.name = document.getElementById('NameInput').value;
      obj.number = document.getElementById('EmailInput').value;
      obj.text = document.getElementById('contactInput').value;

      axios.post(crudurl + "/sellertData", obj)
        .then(response => {
          list.appendChild(createListItem(response.data.name, response.data.number, response.data.text));
          updateTotalPrice();
        })
        .catch((error) => console.log(error));
    });

    list.addEventListener('click', e => {
      if (e.target.classList.contains('Delete')) {
        let li = e.target.parentElement;
        let text = li.innerHTML;
        let item = text.split(" -");
        axios.get(crudurl + "/sellerData")
          .then(res => {
            for (let i = 0; i < res.data.length; i++) {
              if (res.data[i].name === item[0]) {
                axios.delete(crudurl + "/sellerData/" + res.data[i]._id)
                  .then(() => {
                    updateTotalPrice();
                  })
                  .catch((error) => console.log(error));
              }
            }
          });
        list.removeChild(li);
      }
    });


    list.addEventListener('click', e => {
      if (e.target.classList.contains('Edit')) {
        let li = e.target.parentElement;
        let text = li.innerHTML;
        let item = text.split(" -");
        axios.get(crudurl + "/sellerData")
          .then(res => {
            for (let i = 0; i < res.data.length; i++) {
              if (res.data[i].name === item[0]) {
                document.getElementById('NameInput').value = res.data[i].name;
                document.getElementById('EmailInput').value = res.data[i].email;
                document.getElementById('contactInput').value = res.data[i].number;
                axios.delete(crudurl + res.data[i]._id);
              }
            }
          });
        list.removeChild(li);
      }
    });

  </script>
</body>

</html>
