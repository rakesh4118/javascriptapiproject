<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRUD App with Bootstrap</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
  <div class="container mt-5">
    <form>
      <div class="form-group">
        <label for="NameInput">Name</label>
        <input type="text" class="form-control" id="NameInput" placeholder="Enter name">
      </div>
      <div class="form-group">
        <label for="EmailInput">Email</label>
        <input type="email" class="form-control" id="EmailInput" placeholder="Enter email">
      </div>
      <div class="form-group">
        <label for="contactInput">Contact Number</label>
        <input type="tel" class="form-control" id="contactInput" placeholder="Enter contact number">
      </div>
      <button type="button" id="submitbtn" class="btn btn-primary">Submit</button>
    </form>
    <hr>
    <ul id="items" class="list-group"></ul>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.4/axios.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    const crudurl = "https://crudcrud.com/api/38d3b825507e48e1bb467a44ead8cc94";
    let list = document.getElementById('items');

    showData();

    function createListItem(name, email, number) {
      let li = document.createElement('li');
      li.className = "list-group-item";

      let deletebtn = document.createElement('button');
      deletebtn.innerHTML = 'Delete';
      deletebtn.className = 'btn btn-danger Delete mr-2';

      let editbtn = document.createElement('button');
      editbtn.innerHTML = "Edit";
      editbtn.className = "btn btn-primary Edit";

      li.innerHTML = `${name} - ${email} - ${number}`;
      li.appendChild(deletebtn);
      li.appendChild(editbtn);

      return li;
    }

    function showData() {
      axios.get(crudurl + "/appointmentData")
        .then((response) => {
          for (let i = 0; i < response.data.length; i++) {
            list.appendChild(createListItem(response.data[i].name, response.data[i].email, response.data[i].number));
          }
        })
        .catch((error) => console.log(error));
    }

    let btn = document.getElementById('submitbtn');
    btn.addEventListener('click', (e) => {
      let obj = {
        name: '',
        email: '',
        number: ''
      };
      obj.name = document.getElementById('NameInput').value;
      obj.email = document.getElementById('EmailInput').value;
      obj.number = document.getElementById('contactInput').value;

      axios.post(crudurl + "/appointmentData", obj)
        .then(response => {
          list.appendChild(createListItem(response.data.name, response.data.email, response.data.number));
        })
        .catch((error) => console.log(error));
    });

    list.addEventListener('click', e => {
      if (e.target.classList.contains('Delete')) {
        let li = e.target.parentElement;
        let text = li.innerHTML;
        let item = text.split(" -");
        axios.get(crudurl + "/appointmentData")
          .then(res => {
            for (let i = 0; i < res.data.length; i++) {
              if (res.data[i].name === item[0]) {
                axios.delete(crudurl + "/appointmentData/" + res.data[i]._id);
              }
            }
          });
        list.removeChild(li);
      }
    });

    list.addEventListener('click', e => {
      if (e.target.classList.contains('Edit')) {
        let li = e.target.parentElement;
        let text = li.innerHTML;
        let item = text.split(" -");
        axios.get(crudurl + "/appointmentData")
          .then(res => {
            for (let i = 0; i < res.data.length; i++) {
              if (res.data[i].name === item[0]) {
                document.getElementById('NameInput').value = res.data[i].name;
                document.getElementById('EmailInput').value = res.data[i].email;
                document.getElementById('contactInput').value = res.data[i].number;
                axios.delete(crudurl + res.data[i]._id);
              }
            }
          });
        list.removeChild(li);
      }
    });
  </script>
</body>

</html>
