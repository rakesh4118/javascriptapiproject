<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRUD App with Bootstrap</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
  <div class="container mt-5">
    <form>
      <div class="form-group">
        <label for="NameInput">Name</label>
        <input type="text" class="form-control" id="NameInput" placeholder="Enter name">
      </div>
      <div class="form-group">
        <label for="EmailInput">Email</label>
        <input type="email" class="form-control" id="EmailInput" placeholder="Enter email">
      </div>
      <div class="form-group">
        <label for="contactInput">Contact Number</label>
        <input type="tel" class="form-control" id="contactInput" placeholder="Enter contact number">
      </div>
      <button type="button" id="submitbtn" class="btn btn-primary">Submit</button>
    </form>
    <hr>
    <ul id="items" class="list-group"></ul>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.4/axios.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
const crudurl = "https://crudcrud.com/api/bcf0ff949d3b46f28d7adc227b9c29f6";
let list = document.getElementById('items');
    showData();

    function createListItem(name, email, number) {
      let li = document.createElement('li');
      li.className = "list-group-item";

      let deletebtn = document.createElement('button');
      deletebtn.innerHTML = 'Delete';
      deletebtn.className = 'btn btn-danger Delete mr-2';

      let editbtn = document.createElement('button');
      editbtn.innerHTML = "Edit";
      editbtn.className = "btn btn-primary Edit";

      li.innerHTML = `${name} - ${email} - ${number}`;
      li.appendChild(deletebtn);
      li.appendChild(editbtn);

      return li;
    }
async function showData() {
  const data = await axios.get(crudurl + "/appointmentData");
  for (let i = 0; i < data.data.length; i++) {
    list.appendChild(createListItem(data.data[i].name, data.data[i].email, data.data[i].number));
  }
}

async function submit() {
  const obj = {
    name: document.getElementById('NameInput').value,
    email: document.getElementById('EmailInput').value,
    number: document.getElementById('contactInput').value
  };

  const response = await axios.post(crudurl + "/appointmentData", obj);
  list.appendChild(createListItem(response.data.name, response.data.email, response.data.number));
  document.getElementById('NameInput').value = '';
  document.getElementById('EmailInput').value = '';
  document.getElementById('contactInput').value = '';
}

async function deleteItem(li) {
  const text = li.innerHTML;
  const item = text.split(" -");
  const res = await axios.get(crudurl + "/appointmentData");
  for (let i = 0; i < res.data.length; i++) {
    if (res.data[i].name === item[0]) {
      await axios.delete(crudurl + "/appointmentData/" + res.data[i]._id);
    }
  }
  list.removeChild(li);
}

list.addEventListener('click', async e => {
  if (e.target.classList.contains('Delete')) {
    await deleteItem(e.target.parentElement);
  } else if (e.target.classList.contains('Edit')) {
    const text = e.target.parentElement.innerHTML;
    const item = text.split(" -");
    document.getElementById('NameInput').value = item[0];
    document.getElementById('EmailInput').value = item[1];
    document.getElementById('contactInput').value = item[2];
  }
});

showData();
document.getElementById('submitbtn').addEventListener('click', submit);
</script>
</body>
</html>
